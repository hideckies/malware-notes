---
import { getCollection } from "astro:content";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import IconMalwares from "../../../components/IconMalware";

export async function getStaticPaths() {
    const allMalwares = await getCollection("malware-families");
    const uniqueLangs = [...new Set(allMalwares.map((mal: any) => mal.data.langs != null ? mal.data.langs : 'none').flat())];

    return uniqueLangs.map((lang: string) => {
        const filteredMalwares = allMalwares.filter((mal) => {
            if (mal.data.langs != null) {
                return mal.data.langs.includes(lang);
            }
        });
        return {
            params: { lang },
            props: { malwares: filteredMalwares },
        };
    })
}

const { lang }: { lang: string } = Astro.params;
const { malwares } = Astro.props;

const title = `Malware Families That Use "${lang == 'CS' ? 'C#' : lang}"`;
const description = "List of malware families with specific platform.";
---

<BaseLayout title={title + " | Malware Notes"} description={description}>
    <main class="my-6 md:mx-auto w-full md:w-2/3 p-2 flex flex-col gap-y-8">
        <h1 class="text-2xl md:text-3xl text-center font-bold">
            {title}
        </h1>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 justify-center gap-2">
            {malwares.map((mal: any) => (
                <div class="bg-slate-800 hover:bg-slate-700 px-2 py-4 flex items-center gap-x-2 break-words">
                    <IconMalwares color="var(--color-red)" size="1.2" className="" />
                    <a
                        href={`/malware-families/${mal.slug}`}
                        class="text-white truncate"
                    >
                        {mal.data.title}
                    </a>
                </div>
            ))}
        </div>
        <div class="text-right">
            <a
                href="/malware-families/langs"
                class="bg-slate-800 hover:bg-slate-700 p-4"
            >
                All Programming Languages
            </a>
        </div>
    </main>
</BaseLayout>