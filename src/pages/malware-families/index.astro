---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import IconMalware from "../../components/IconMalware";
import SideLinks from "../../components/SideLinks.astro";

const allMalwares = await getCollection('malware-families');
const years = [...new Set(allMalwares.map((malware: any) => malware.data.identified).flat())];
years.sort();
const categories = [...new Set(allMalwares.map((malware: any) => malware.data.types).flat())];
categories.sort();
const features = [...new Set(allMalwares.map((malware: any) => malware.data.features).flat())];
features.sort();
const langs = [...new Set(allMalwares.map((malware: any) => malware.data.langs).flat())];
langs.sort();
const platforms = [...new Set(allMalwares.map((malware: any) => malware.data.platforms).flat())];
platforms.sort();

const title = "Malware Families";
const description = "This is the top page for malware families.";
---

<BaseLayout title={title + " | Malware Notes"} description={description}>
    <div class="mx-auto w-full md:w-2/3 md:grid md:grid-cols-[200px_1fr]">
        <SideLinks category="malware-families" currentTitle="" />
        <main class="px-2 md:px-8 flex flex-col gap-y-8">

            <div class="flex items-center gap-x-2">
                <IconMalware color="var(--color-red)" size="3" className="" />
                <h1
                    class="
                        text-6xl text-transparent font-black
                        bg-gradient-to-r from-red-600 to-orange-600 bg-clip-text
                    "
                >
                    {title}
                </h1>
            </div>

            <div class="flex flex-col gap-y-2">
                <h2 class="text-2xl font-bold">Search By Years</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cold-4 gap-2">
                    {years.map((year: number) => (
                        year ? (
                            <a
                                href={`/malware-families/years/${year}`}
                                class="bg-slate-800 hover:bg-slate-700 px-2 py-3 break-words"
                            >
                                {year}
                            </a>
                        ): null
                    ))}
                </div>
            </div>
            <div class="flex flex-col gap-2">
                <h2 class="text-2xl font-bold">Search By Categories</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cold-4 gap-2">
                    {categories.map((category: string) => (
                        category ? (
                            <a
                                href={`/malware-families/types/${category}`}
                                class="bg-slate-800 hover:bg-slate-700 px-2 py-3 break-words"
                            >
                                {category}
                            </a>
                        ): null
                    ))}
                </div>
            </div>
            <div class="flex flex-col gap-2">
                <h2 class="text-2xl font-bold">Search By Features</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cold-4 gap-2">
                    {features.map((feature: string) => (
                        feature ? (
                            <a
                                href={`/malware-families/features/${feature}`}
                                class="bg-slate-800 hover:bg-slate-700 px-2 py-3 break-words"
                            >
                                {feature}
                            </a>
                        ): null
                    ))}
                </div>
            </div>
            <div class="flex flex-col gap-2">
                <h2 class="text-2xl font-bold">Search By Platforms</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cold-4 gap-2">
                    {platforms.map((platform: string) => (
                        platform ? (
                            <a
                                href={`/malware-families/platforms/${platform}`}
                                class="bg-slate-800 hover:bg-slate-700 px-2 py-3 break-words"
                            >
                                {platform}
                            </a>
                        ): null
                    ))}
                </div>
            </div>
            <div class="flex flex-col gap-2">
                <h2 class="text-2xl font-bold">Search By Programming Languages</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cold-4 gap-2">
                    {langs.map((lang: string) => (
                        lang ? (
                            <a
                                href={`/malware-families/langs/${lang}`}
                                class="bg-slate-800 hover:bg-slate-700 px-2 py-3 break-words"
                            >
                                {lang == 'CS' ? 'C#' : lang}
                            </a>
                        ): null
                    ))}
                </div>
            </div>
        </main>
    </div>
</BaseLayout>
