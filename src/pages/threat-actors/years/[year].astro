---
import { getCollection } from "astro:content";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import IconActor from "../../../components/IconActor";

export async function getStaticPaths() {
    const allActors = await getCollection("threat-actors");
    const uniqueYears = [...new Set(allActors.map((actor: any) => actor.data.identified != null ? actor.data.identified : 'none').flat())];

    return uniqueYears.map((year: number) => {
        const filteredMalwares = allActors.filter((actor: any) => {
            return actor.data.identified === year;
        });
        return {
            params: { year },
            props: { actors: filteredMalwares },
        };
    })
}

const { year }: { year: number } = Astro.params;
const { actors } = Astro.props;

const title = `Threat Actors That Are Idenfieid In "${year}"`;
const description = "List of malware families with specific platform.";
---

<BaseLayout title={title + " | Malware Notes"} description={description}>
    <main class="my-6 md:mx-auto w-full md:w-2/3 p-2 flex flex-col gap-y-8">
        <h1 class="text-2xl md:text-3xl text-center font-bold">
            {title}
        </h1>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 justify-center gap-2">
            {actors.map((actor: any) => (
                <div class="bg-slate-800 hover:bg-slate-700 px-2 py-4 flex items-center gap-x-2 break-words">
                    <IconActor color="var(--color-red)" size="1.2" className="" />
                    <a
                        href={`/threat-actors/${actor.slug}`}
                        class="text-white truncate"
                    >
                        {actor.data.title}
                    </a>
                </div>
            ))}
        </div>
        <div class="text-right">
            <a
                href="/threat-actors/years"
                class="bg-slate-800 hover:bg-slate-700 p-4"
            >
                All Years
            </a>
        </div>
    </main>
</BaseLayout>