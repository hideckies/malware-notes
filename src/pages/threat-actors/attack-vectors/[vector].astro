---
import { getCollection } from "astro:content";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import IconActor from "../../../components/IconActor";

export async function getStaticPaths() {
    const allActors = await getCollection("threat-actors");
    const uniqueVectors = [...new Set(allActors.map((actor: any) => actor.data.attack_vectors != null ? actor.data.attack_vectors : 'none').flat())];

    return uniqueVectors.map((vector: string) => {
        const filteredActors = allActors.filter((actor: any) => {
            if (actor.data.attack_vectors != null) {
                return actor.data.attack_vectors.includes(vector);
            }
        });
        return {
            params: { vector },
            props: { actors: filteredActors },
        };
    })
}

const { vector } = Astro.params;
const { actors } = Astro.props;

const title = `Threat Actors That Use "${vector}" For An Attack Vector`;
const description = "Threat actors attack vector.";
---

<BaseLayout title={title + " | Malware Notes"} description={description}>
    <main class="my-6 md:mx-auto w-full md:w-2/3 p-2 flex flex-col gap-y-8">
        <h1 class="text-2xl md:text-3xl text-center font-bold">
            {title}
        </h1>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 justify-center gap-2">
            {actors.map((actor: any) => (
                <div class="bg-slate-800 hover:bg-slate-700 px-2 py-4 flex items-center gap-x-2 break-words">
                    <IconActor color="var(--color-red)" size="1.2" className="" />
                    <a
                        href={`/threat-actors/${actor.slug}`}
                        class="text-white truncate"
                    >
                        {actor.data.title}
                    </a>
                </div>
            ))}
        </div>
        <div class="text-right">
            <a
                href="/threat-actors/attack-vectors"
                class="bg-slate-800 hover:bg-slate-700 p-4"
            >
                All Attack Vectors
            </a>
        </div>
    </main>
</BaseLayout>