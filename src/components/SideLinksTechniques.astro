---
import { getCollection } from "astro:content";
const { currentTitle } = Astro.props;

const allTechniques = await getCollection('techniques');
const types = [...new Set(allTechniques.map((tech: any) => tech.data.type).flat())];
types.sort();
---

<div class="sidelinks h-[90vh] w-full relative hidden md:block">
    <div class="sidelinks_wrapper sticky top-0 left-0 flex flex-col gap-y-4 h-full w-full overflow-y-auto">
        {types.map((t: string) => (
            <div class="flex flex-col gap-y-2">
                <span class="p-1 text-sm text-slate-500">{t}</span>
                <div class="flex flex-col gap-y-1">
                    {allTechniques.map((tech: any) => (
                        tech.data.type === t ? (
                            <a
                                href={`/techniques/${tech.slug}/`}
                                class={`
                                    p-1 text-slate-400 hover:text-white
                                    ${tech.data.title === currentTitle ? 'current-title bg-dark-light-super text-slate-200' : ''}
                                `}
                            >
                                {tech.data.title}
                            </a>
                        ) : null
                    ))}
                </div>
            </div>
        ))}
    </div>
</div>

<script>
    function scrollSideLinks() {
        const elemWrapper = document.querySelector('.sidelinks_wrapper')
        const elemCurrent = document.querySelector('.current-title')
        if (elemWrapper && elemCurrent) {
            const targetTopPosition = elemCurrent.getBoundingClientRect().top
            if (targetTopPosition) {
                const targetPosition = targetTopPosition
                const offset = 100

                elemWrapper.scrollTo({
                    top: targetPosition - offset,
                    behavior: 'smooth'
                })
            }
        }
    }

    document.addEventListener('astr:load', () => {
        scrollSideLinks()
    })
</script>